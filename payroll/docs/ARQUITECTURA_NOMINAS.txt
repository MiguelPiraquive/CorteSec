================================================================================
ANÃLISIS DE ARQUITECTURA - BACKEND CORTESEC
================================================================================

ğŸ“¦ ESTRUCTURA ACTUAL:
--------------------

/backend/
  â””â”€ payroll/                    â† UNA SOLA APP DE DJANGO
      â”œâ”€ models.py               â† TODOS LOS MODELOS AQUÃ
      â”œâ”€ api_views.py
      â”œâ”€ serializers.py
      â””â”€ migrations/

ğŸ“Š MODELOS EN payroll/models.py:
--------------------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ“DULO 1: NÃ“MINA SIMPLE (RRHH)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Nomina                  â† NÃ³mina interna de RRHH         â”‚
â”‚ â€¢ DetalleNomina          â† Detalles de producciÃ³n          â”‚
â”‚ â€¢ DetalleDeduccion       â† Deducciones aplicadas           â”‚
â”‚ â€¢ ComprobanteContableNomina â† Comprobantes contables       â”‚
â”‚ â€¢ HistorialNomina        â† AuditorÃ­a de cambios            â”‚
â”‚                                                              â”‚
â”‚ USADA EN: /recursos-humanos/nomina                         â”‚
â”‚ FRONTEND: src/pages/nomina/NominaPage.jsx                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ“DULO 2: NÃ“MINA ELECTRÃ“NICA (DIAN)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ NominaElectronica      â† NÃ³mina legal para DIAN         â”‚
â”‚ â€¢ DevengadoNominaElectronica â† Devengados (XML)           â”‚
â”‚ â€¢ DeduccionNominaElectronica â† Deducciones (XML)          â”‚
â”‚ â€¢ ConfiguracionNominaElectronica â† Config certificado     â”‚
â”‚ â€¢ WebhookConfig          â† Webhooks DIAN                   â”‚
â”‚ â€¢ WebhookLog             â† Logs de webhooks                â”‚
â”‚                                                              â”‚
â”‚ USADA EN: /payroll/nominas-electronicas                   â”‚
â”‚ FRONTEND: src/pages/payroll/NominaElectronicaPage.jsx     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ“DULOS COMPARTIDOS                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Empleado               â† Empleados (compartido)          â”‚
â”‚ â€¢ Contrato               â† Contratos                        â”‚
â”‚ â€¢ PeriodoNomina          â† Periodos de pago                â”‚
â”‚ â€¢ TipoDocumento          â† CatÃ¡logos                        â”‚
â”‚ â€¢ TipoTrabajador         â† CatÃ¡logos                        â”‚
â”‚ â€¢ TipoContrato           â† CatÃ¡logos                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ”— RELACIÃ“N PROBLEMÃTICA (ANTES):
---------------------------------

NominaElectronica
    â””â”€> nomina (OneToOneField REQUIRED) 
            â””â”€> Nomina
                    â”œâ”€> empleado
                    â”œâ”€> periodo
                    â”œâ”€> periodo_inicio
                    â””â”€> periodo_fin

PROBLEMA: Para crear NominaElectronica, OBLIGATORIAMENTE 
          habÃ­a que crear primero Nomina (simple).


âœ… RELACIÃ“N ARREGLADA (AHORA):
------------------------------

NominaElectronica
    â”œâ”€> nomina (OneToOneField OPCIONAL - null=True) â† Referencia opcional
    â”œâ”€> empleado (ForeignKey DIRECTO)               â† Nuevo campo
    â”œâ”€> periodo (ForeignKey DIRECTO)                â† Nuevo campo  
    â”œâ”€> periodo_inicio (DateField)                  â† Nuevo campo
    â”œâ”€> periodo_fin (DateField)                     â† Nuevo campo
    â””â”€> dias_trabajados (IntegerField)              â† Nuevo campo

SOLUCIÃ“N: NominaElectronica ahora tiene sus PROPIOS datos,
          independiente de Nomina (simple).


ğŸ“‹ TABLAS EN BASE DE DATOS:
---------------------------

PostgreSQL Database:
  â”œâ”€ payroll_nomina                        â† NÃ³mina Simple (RRHH)
  â”œâ”€ payroll_detallenomina
  â”œâ”€ payroll_detallededuccion
  â”œâ”€ payroll_comprobantecontablenomina
  â”œâ”€ payroll_historialnomina
  â”‚
  â”œâ”€ payroll_nominaelectronica            â† NÃ³mina ElectrÃ³nica (DIAN)
  â”œâ”€ payroll_devengadonominaelectronica
  â”œâ”€ payroll_deducciononominaelectronica
  â”œâ”€ payroll_configuracionnominaelectronica
  â”œâ”€ payroll_webhookconfig
  â”œâ”€ payroll_webhooklog
  â”‚
  â””â”€ payroll_empleado                      â† Compartidos
     payroll_contrato
     payroll_periodonmina
     payroll_tipodocumento
     payroll_tipotrabajador
     payroll_tipocontrato


ğŸ¯ FLUJOS SEPARADOS:
-------------------

FLUJO 1: NÃ³mina Simple (RRHH)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Usuario va a /recursos-humanos/nomina  â”‚
â”‚ 2. Crea Nomina                            â”‚
â”‚ 3. Agrega DetalleNomina (producciÃ³n)     â”‚
â”‚ 4. Calcula totales                         â”‚
â”‚ 5. Genera desprendible PDF                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FLUJO 2: NÃ³mina ElectrÃ³nica (DIAN) - INDEPENDIENTE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Usuario va a /payroll/nominas-elect.   â”‚
â”‚ 2. Click "Nueva NÃ³mina"                    â”‚
â”‚ 3. Selecciona: Empleado + Periodo         â”‚
â”‚ 4. Crea NominaElectronica DIRECTO         â”‚
â”‚    (SIN crear Nomina simple)               â”‚
â”‚ 5. Genera XML para DIAN                    â”‚
â”‚ 6. Firma digitalmente                      â”‚
â”‚ 7. EnvÃ­a a DIAN                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ’¡ CONCLUSIÃ“N:
-------------

NO HAY DOS CARPETAS SEPARADAS.
TODO ESTÃ EN UNA SOLA APP: payroll/

Pero dentro de esa app hay DOS SISTEMAS LÃ“GICOS:
  1. Sistema de NÃ³mina Simple (RRHH interno)
  2. Sistema de NÃ³mina ElectrÃ³nica (DIAN legal)

Ahora estÃ¡n DESACOPLADOS:
  âœ… Puedes crear Nomina sin NominaElectronica
  âœ… Puedes crear NominaElectronica sin Nomina
  âœ… Opcionalmente puedes vincularlas (campo nomina nullable)


ğŸš€ PRÃ“XIMOS PASOS:
-----------------

1. Frontend ya estÃ¡ configurado para ambos sistemas
2. Backend ya tiene la migraciÃ³n aplicada
3. Prueba crear una nÃ³mina electrÃ³nica desde cero
4. El campo "nomina" quedarÃ¡ en NULL (no hay problema)
5. La nÃ³mina electrÃ³nica tendrÃ¡ sus propios datos

================================================================================
